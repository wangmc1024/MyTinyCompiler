<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽象语法树可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
    <script>
        let currentScale = 1.0;
        const minScale = 0.1;  // 减小最小缩放比例
        const maxScale = 5.0;   // 增大最大缩放比例
        const scaleStep = 0.1;
        
        function zoomIn() {
            if (currentScale < maxScale) {
                currentScale += scaleStep;
                updateZoom();
            }
        }
        
        function zoomOut() {
            if (currentScale > minScale) {
                currentScale -= scaleStep;
                updateZoom();
            }
        }
        
        function resetZoom() {
            currentScale = 1.0;
            updateZoom();
        }
        
        function updateZoom() {
            const mermaidContainer = document.getElementById('mermaid-container');
            if (mermaidContainer) {
                mermaidContainer.style.transform = `scale(${currentScale})`;
                mermaidContainer.style.transformOrigin = 'top left';
                
                // 更新缩放显示
                const zoomDisplay = document.getElementById('zoom-display');
                if (zoomDisplay) {
                    zoomDisplay.textContent = `${Math.round(currentScale * 100)}%`;
                }
            }
        }
        
        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch(event.key) {
                    case '=':
                    case '+':
                        event.preventDefault();
                        zoomIn();
                        break;
                    case '-':
                        event.preventDefault();
                        zoomOut();
                        break;
                    case '0':
                        event.preventDefault();
                        resetZoom();
                        break;
                }
            }
        });
        
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: { 
                rankDir: 'TB',
                nodeSpacing: 10,
                rankSpacing: 30,
                diagramPadding: 10,
                useMaxWidth: false,  // 不限制最大宽度
                htmlLabels: true
            },
            securityLevel: 'loose',  // 松散安全级别以支持更多特性
            maxTextSize: 100000,     // 增加最大文本大小限制
            maxEdges: 10000          // 增加最大边数限制
        });
    </script>
    <style>
        body { 
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .zoom-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        .zoom-btn:hover {
            background: #f0f0f0;
            border-color: #999;
        }
        .zoom-display {
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        .mermaid-container {
            width: 100%;
            overflow: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.2s ease;
        }
        .mermaid {
            min-width: fit-content;
            min-height: fit-content;
        }
        .shortcut-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AST可视化</h1>
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomOut()" title="缩小 (Ctrl+-)">-</button>
            <span class="zoom-display" id="zoom-display">100%</span>
            <button class="zoom-btn" onclick="zoomIn()" title="放大 (Ctrl++)">+</button>
            <button class="zoom-btn" onclick="resetZoom()" title="重置缩放 (Ctrl+0)">重置</button>
        </div>
    </div>
    <div class="shortcut-hint">提示: 使用 Ctrl++ 放大, Ctrl+- 缩小, Ctrl+0 重置</div>
    <div id="mermaid-container" class="mermaid-container">
        <div class="mermaid">
            graph TD
    1[topLevel]
    1 --> 2
    2[declareList]
    2 --> 3
    3[declare]
    3 --> 4
    4[bool]
    3 --> 5
    5[varList]
    5 --> 6
    6[$ef$]
    5 --> 7
    7[emptyVarList]
    2 --> 8
    8[linkDeclareList]
    8 --> 9
    9[declare]
    9 --> 10
    10[string]
    9 --> 11
    11[varList]
    11 --> 12
    12[$u$]
    11 --> 13
    13[emptyVarList]
    8 --> 14
    14[linkDeclareList]
    14 --> 15
    15[declare]
    15 --> 16
    16[int]
    15 --> 17
    17[varList]
    17 --> 18
    18[$g$]
    17 --> 19
    19[emptyVarList]
    14 --> 20
    20[linkDeclareList]
    20 --> 21
    21[declare]
    21 --> 22
    22[int]
    21 --> 23
    23[varList]
    23 --> 24
    24[$a3x$]
    23 --> 25
    25[linkVarList]
    25 --> 26
    26[$l$]
    25 --> 27
    27[emptyVarList]
    20 --> 28
    28[emptyDeclareList]
    1 --> 29
    29[seqList]
    29 --> 30
    30[Statement]
    30 --> 31
    31[assign]
    31 --> 32
    32[$ef$]
    31 --> 33
    33[expression]
    33 --> 34
    34[conjunction]
    34 --> 35
    35[term]
    35 --> 36
    36[false]
    35 --> 37
    37[empty]
    34 --> 38
    38[empty]
    33 --> 39
    39[empty]
    29 --> 40
    40[linkSeqList]
    40 --> 41
    41[Statement]
    41 --> 42
    42[assign]
    42 --> 43
    43[$a3x$]
    42 --> 44
    44[expression]
    44 --> 45
    45[conjunction]
    45 --> 46
    46[term]
    46 --> 47
    47[805]
    46 --> 48
    48[empty]
    45 --> 49
    49[empty]
    44 --> 50
    50[empty]
    40 --> 51
    51[linkSeqList]
    51 --> 52
    52[Statement]
    52 --> 53
    53[assign]
    53 --> 54
    54[$g$]
    53 --> 55
    55[expression]
    55 --> 56
    56[conjunction]
    56 --> 57
    57[term]
    57 --> 58
    58[423]
    57 --> 59
    59[empty]
    56 --> 60
    60[empty]
    55 --> 61
    61[empty]
    51 --> 62
    62[linkSeqList]
    62 --> 63
    63[Statement]
    63 --> 64
    64[assign]
    64 --> 65
    65[$l$]
    64 --> 66
    66[expression]
    66 --> 67
    67[conjunction]
    67 --> 68
    68[term]
    68 --> 69
    69[74]
    68 --> 70
    70[empty]
    67 --> 71
    71[empty]
    66 --> 72
    72[empty]
    62 --> 73
    73[linkSeqList]
    73 --> 74
    74[Statement]
    74 --> 75
    75[while]
    75 --> 76
    76[expression]
    76 --> 77
    77[conjunction]
    77 --> 78
    78[term]
    78 --> 79
    79["k"]
    78 --> 80
    80[empty]
    77 --> 81
    81[empty]
    76 --> 82
    82[or]
    82 --> 83
    83[conjunction]
    83 --> 84
    84[term]
    84 --> 85
    85[$ef$]
    84 --> 86
    86[empty]
    83 --> 87
    87[empty]
    75 --> 88
    88[nestedStatement]
    73 --> 89
    89[linkSeqList]
        </div>
    </div>
</body>
</html>