<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽象语法树可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js"></script>
    <script>
        let currentScale = 1.0;
        const minScale = 0.1;  // 减小最小缩放比例
        const maxScale = 5.0;   // 增大最大缩放比例
        const scaleStep = 0.1;
        
        function zoomIn() {
            if (currentScale < maxScale) {
                currentScale += scaleStep;
                updateZoom();
            }
        }
        
        function zoomOut() {
            if (currentScale > minScale) {
                currentScale -= scaleStep;
                updateZoom();
            }
        }
        
        function resetZoom() {
            currentScale = 1.0;
            updateZoom();
        }
        
        function updateZoom() {
            const mermaidContainer = document.getElementById('mermaid-container');
            if (mermaidContainer) {
                mermaidContainer.style.transform = `scale(${currentScale})`;
                mermaidContainer.style.transformOrigin = 'top left';
                
                // 更新缩放显示
                const zoomDisplay = document.getElementById('zoom-display');
                if (zoomDisplay) {
                    zoomDisplay.textContent = `${Math.round(currentScale * 100)}%`;
                }
            }
        }
        
        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch(event.key) {
                    case '=':
                    case '+':
                        event.preventDefault();
                        zoomIn();
                        break;
                    case '-':
                        event.preventDefault();
                        zoomOut();
                        break;
                    case '0':
                        event.preventDefault();
                        resetZoom();
                        break;
                }
            }
        });
        
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: { 
                rankDir: 'TB',
                nodeSpacing: 10,
                rankSpacing: 30,
                diagramPadding: 10,
                useMaxWidth: false,  // 不限制最大宽度
                htmlLabels: true
            },
            securityLevel: 'loose',  // 松散安全级别以支持更多特性
            maxTextSize: 100000,     // 增加最大文本大小限制
            maxEdges: 10000          // 增加最大边数限制
        });
    </script>
    <style>
        body { 
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .zoom-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        .zoom-btn:hover {
            background: #f0f0f0;
            border-color: #999;
        }
        .zoom-display {
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        .mermaid-container {
            width: 100%;
            overflow: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.2s ease;
        }
        .mermaid {
            min-width: fit-content;
            min-height: fit-content;
        }
        .shortcut-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AST可视化</h1>
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomOut()" title="缩小 (Ctrl+-)">-</button>
            <span class="zoom-display" id="zoom-display">100%</span>
            <button class="zoom-btn" onclick="zoomIn()" title="放大 (Ctrl++)">+</button>
            <button class="zoom-btn" onclick="resetZoom()" title="重置缩放 (Ctrl+0)">重置</button>
        </div>
    </div>
    <div class="shortcut-hint">提示: 使用 Ctrl++ 放大, Ctrl+- 缩小, Ctrl+0 重置</div>
    <div id="mermaid-container" class="mermaid-container">
        <div class="mermaid">
            graph TD
    1[topLevel]
    1 --> 2
    2[declareList]
    2 --> 3
    3[declare]
    3 --> 4
    4[string]
    3 --> 5
    5[varList]
    5 --> 6
    6[$c$]
    5 --> 7
    7[linkVarList]
    7 --> 8
    8[$f$]
    7 --> 9
    9[emptyVarList]
    2 --> 10
    10[linkDeclareList]
    10 --> 11
    11[declare]
    11 --> 12
    12[int]
    11 --> 13
    13[varList]
    13 --> 14
    14[$s$]
    13 --> 15
    15[linkVarList]
    15 --> 16
    16[$g$]
    15 --> 17
    17[emptyVarList]
    10 --> 18
    18[linkDeclareList]
    18 --> 19
    19[declare]
    19 --> 20
    20[bool]
    19 --> 21
    21[varList]
    21 --> 22
    22[$e$]
    21 --> 23
    23[emptyVarList]
    18 --> 24
    24[linkDeclareList]
    24 --> 25
    25[declare]
    25 --> 26
    26[string]
    25 --> 27
    27[varList]
    27 --> 28
    28[$qb$]
    27 --> 29
    29[linkVarList]
    29 --> 30
    30[$d$]
    29 --> 31
    31[emptyVarList]
    24 --> 32
    32[emptyDeclareList]
    1 --> 33
    33[seqList]
    33 --> 34
    34[Statement]
    34 --> 35
    35[assign]
    35 --> 36
    36[$d$]
    35 --> 37
    37[expression]
    37 --> 38
    38[conjunction]
    38 --> 39
    39[term]
    39 --> 40
    40["zg"]
    39 --> 41
    41[empty]
    38 --> 42
    42[empty]
    37 --> 43
    43[empty]
    33 --> 44
    44[linkSeqList]
    44 --> 45
    45[Statement]
    45 --> 46
    46[assign]
    46 --> 47
    47[$f$]
    46 --> 48
    48[expression]
    48 --> 49
    49[conjunction]
    49 --> 50
    50[term]
    50 --> 51
    51["r"]
    50 --> 52
    52[empty]
    49 --> 53
    53[empty]
    48 --> 54
    54[empty]
    44 --> 55
    55[linkSeqList]
    55 --> 56
    56[Statement]
    56 --> 57
    57[assign]
    57 --> 58
    58[$c$]
    57 --> 59
    59[expression]
    59 --> 60
    60[conjunction]
    60 --> 61
    61[term]
    61 --> 62
    62["jw"]
    61 --> 63
    63[empty]
    60 --> 64
    64[empty]
    59 --> 65
    65[empty]
    55 --> 66
    66[linkSeqList]
    66 --> 67
    67[Statement]
    67 --> 68
    68[assign]
    68 --> 69
    69[$s$]
    68 --> 70
    70[expression]
    70 --> 71
    71[conjunction]
    71 --> 72
    72[term]
    72 --> 73
    73[347]
    72 --> 74
    74[empty]
    71 --> 75
    75[empty]
    70 --> 76
    76[empty]
    66 --> 77
    77[linkSeqList]
    77 --> 78
    78[Statement]
    78 --> 79
    79[assign]
    79 --> 80
    80[$qb$]
    79 --> 81
    81[expression]
    81 --> 82
    82[conjunction]
    82 --> 83
    83[term]
    83 --> 84
    84["v"]
    83 --> 85
    85[empty]
    82 --> 86
    86[empty]
    81 --> 87
    87[empty]
    77 --> 88
    88[linkSeqList]
    88 --> 89
    89[Statement]
    89 --> 90
    90[assign]
    90 --> 91
    91[$e$]
    90 --> 92
    92[expression]
    92 --> 93
    93[conjunction]
    93 --> 94
    94[term]
    94 --> 95
    95[true]
    94 --> 96
    96[empty]
    93 --> 97
    97[empty]
    92 --> 98
    98[empty]
    88 --> 99
    99[linkSeqList]
    99 --> 100
    100[Statement]
    100 --> 101
    101[assign]
    101 --> 102
    102[$g$]
    101 --> 103
    103[expression]
    103 --> 104
    104[conjunction]
    104 --> 105
    105[term]
    105 --> 106
    106[920]
    105 --> 107
    107[empty]
    104 --> 108
    108[empty]
    103 --> 109
    109[empty]
    99 --> 110
    110[linkSeqList]
    110 --> 111
    111[Statement]
    111 --> 112
    112[while]
    112 --> 113
    113[expression]
    113 --> 114
    114[conjunction]
    114 --> 115
    115[term]
    115 --> 116
    116[$e$]
    115 --> 117
    117[empty]
    114 --> 118
    118[empty]
    113 --> 119
    119[or]
    119 --> 120
    120[conjunction]
    120 --> 121
    121[lte]
    121 --> 122
    122[add]
    122 --> 123
    123[term]
    123 --> 124
    124[expression]
    124 --> 125
    125[conjunction]
    125 --> 126
    126[sub]
    126 --> 127
    127[term]
    127 --> 128
    128[$s$]
    127 --> 129
    129[empty]
    126 --> 130
    130[term]
    130 --> 131
    131[82]
    130 --> 132
    132[empty]
    125 --> 133
    133[empty]
    124 --> 134
    134[empty]
    123 --> 135
    135[div]
    135 --> 136
    136[36]
    122 --> 137
    137[term]
    137 --> 138
    138[36]
    137 --> 139
    139[div]
    139 --> 140
    140[$g$]
    121 --> 141
    141[expression]
    141 --> 142
    142[conjunction]
    142 --> 143
    143[add]
    143 --> 144
    144[term]
    144 --> 145
    145["g"]
    144 --> 146
    146[mul]
    146 --> 147
    147[$g$]
    143 --> 148
    148[term]
    148 --> 149
    149[$f$]
    148 --> 150
    150[mul]
    150 --> 151
    151[$g$]
    142 --> 152
    152[and]
    152 --> 153
    153[not]
    153 --> 154
    154[eq]
    154 --> 155
    155[add]
    155 --> 156
    156[term]
    156 --> 157
    157[空字符串]
    156 --> 158
    158[mul]
    158 --> 159
    159[5]
    155 --> 160
    160[term]
    160 --> 161
    161[$c$]
    160 --> 162
    162[mul]
    162 --> 163
    163[$g$]
    154 --> 164
    164[expression]
    164 --> 165
    165[conjunction]
    165 --> 166
    166[sub]
    166 --> 167
    167[term]
    167 --> 168
    168[expression]
    168 --> 169
    169[conjunction]
    169 --> 170
    170[sub]
    170 --> 171
    171[term]
    171 --> 172
    172[$g$]
    171 --> 173
    173[empty]
    170 --> 174
    174[term]
    174 --> 175
    175[37]
    174 --> 176
    176[empty]
    169 --> 177
    177[empty]
    168 --> 178
    178[empty]
    167 --> 179
    179[mul]
    179 --> 180
    180[81]
    166 --> 181
    181[term]
    181 --> 182
    182[expression]
    182 --> 183
    183[conjunction]
    183 --> 184
    184[sub]
    184 --> 185
    185[term]
    185 --> 186
    186[$g$]
    185 --> 187
    187[empty]
    184 --> 188
    188[term]
    188 --> 189
    189[90]
    188 --> 190
    190[empty]
    183 --> 191
    191[empty]
    182 --> 192
    192[empty]
    181 --> 193
    193[mul]
    193 --> 194
    194[$s$]
    165 --> 195
    195[empty]
    164 --> 196
    196[empty]
    141 --> 197
    197[empty]
    120 --> 198
    198[empty]
    112 --> 199
    199[nestedStatement]
    110 --> 200
    200[linkSeqList]
        </div>
    </div>
</body>
</html>